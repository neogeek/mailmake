#!/usr/bin/env node

/* eslint global-require: 0 */

const chalk = require('chalk');

const mailmake = require('..');

const args = require('parse-cmd-args')(null, {
    'requireUserInput': true
});

const options = {
    'from': args.flags['--from'] || args.flags['-f'] || null,
    'subject': args.flags['--subject'] || args.flags['-s'] || null,
    'to': args.flags['--to'] || args.flags['-t'] || null
};

if (args.flags['--version'] || args.flags['-v']) {

    process.stdout.write(`${require('../package').version}\n`);
    process.exit();

} else if (!args.input || args.flags['--help'] || args.flags['-h']) {

    process.stdout.write('\n');
    process.stdout.write(`${chalk.blue(' Usage:')} mailmake <path> [options]\n\n`);
    process.stdout.write(' Options:\n\n');
    process.stdout.write(`${chalk.yellow('  -h, --help')}\t\tDisplay this help message.\n`);
    process.stdout.write(`${chalk.yellow('  -v, --version')}\t\tDisplay the current installed version.\n`);
    process.stdout.write(`${chalk.yellow('  -f, --from')}\t\tSet the from email address header.\n`);
    process.stdout.write(`${chalk.yellow('  -s, --subject')}\t\tSet the subject header.\n`);
    process.stdout.write(`${chalk.yellow('  -t, --to')}\t\tSet the to email address header.\n`);
    process.stdout.write('\n');
    process.exit();

} else {

    mailmake.generate(args.input, options).then(output => {

        process.stdout.write(output);

    });

}
